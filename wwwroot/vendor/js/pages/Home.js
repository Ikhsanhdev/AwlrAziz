/*! For license information please see Home.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var a in n)("object"==typeof exports?exports:t)[a]=n[a]}}(self,()=>(()=>{function t(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(){var t,a,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function l(e,r,o,i){var l=r&&r.prototype instanceof c?r:c,d=Object.create(l.prototype);return n(d,"_invoke",function(e,n,r){var o,i,l,c=0,d=r||[],u=!1,p={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return o=e,i=0,l=t,p.n=n,s}};function m(e,n){for(i=e,l=n,a=0;!u&&c&&!r&&a<d.length;a++){var r,o=d[a],m=p.p,f=o[2];e>3?(r=f===n)&&(l=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=t):o[0]<=m&&((r=e<2&&m<o[1])?(i=0,p.v=n,p.n=o[1]):m<f&&(r=e<3||o[0]>n||n>f)&&(o[4]=e,o[5]=n,p.n=f,i=0))}if(r||e>1)return s;throw u=!0,n}return function(r,d,f){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,f),i=d,l=f;(a=i<2?t:l)||!u;){o||(i?i<3?(i>1&&(p.n=-1),m(i,l)):p.n=l:p.v=l);try{if(c=2,o){if(i||(r="next"),a=o[r]){if(!(a=a.call(o,l)))throw TypeError("iterator result is not an object");if(!a.done)return a;l=a.value,i<2&&(i=0)}else 1===i&&(a=o.return)&&a.call(o),i<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),i=1);o=t}else if((a=(u=p.n<0)?l:e.call(n,p))!==s)break}catch(e){o=t,i=1,l=e}finally{c=1}}return{value:a,done:u}}}(e,o,i),!0),d}var s={};function c(){}function d(){}function u(){}a=Object.getPrototypeOf;var p=[][o]?a(a([][o]())):(n(a={},o,function(){return this}),a),m=u.prototype=c.prototype=Object.create(p);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,n(t,i,"GeneratorFunction")),t.prototype=Object.create(m),t}return d.prototype=u,n(m,"constructor",u),n(u,"constructor",d),d.displayName="GeneratorFunction",n(u,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,o,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:l,m:f}})()}function n(t,e,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}n=function(t,e,a,r){if(e)o?o(t,e,{value:a,enumerable:!r,configurable:!r,writable:!r}):t[e]=a;else{var i=function(e,a){n(t,e,function(t){return this._invoke(e,a,t)})};i("next",0),i("throw",1),i("return",2)}},n(t,e,a,r)}function a(t,e,n,a,r,o,i){try{var l=t[o](i),s=l.value}catch(t){return void n(t)}l.done?e(s):Promise.resolve(s).then(a,r)}function r(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function l(t){a(i,r,o,l,s,"next",t)}function s(t){a(i,r,o,l,s,"throw",t)}l(void 0)})}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=Array(e);n<e;n++)a[n]=t[n];return a}function i(){return(i=r(e().m(function t(){var n,a,r,o;return e().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,fetch("/Home/GetLatestReading");case 1:if((n=t.v).ok){t.n=2;break}throw new Error("Gagal memuat data");case 2:return t.n=3,n.json();case 3:a=t.v,r='<div class="col-md-4 mb-3">\n                <h5>Nama Pos:</h5>\n                <p class="mb-1 fw-semibold">'.concat(a.name||"-",'</p>\n            </div>\n            <div class="col-md-4 mb-3">\n                <h5>Device:</h5>\n                <p class="mb-1 fw-semibold">').concat(a.brand_name||"-",' <span class="badge bg-warning text-dark">').concat(a.device_id||"-",'</span></p>\n            </div>\n            <div class="col-md-4 mb-3">\n                <h5>Tinggi Muka Air (TMA):</h5>\n                <p class="mb-1 text-primary fw-semibold">').concat(parseFloat(a.water_level).toFixed(2),' cm</p>\n            </div>\n            <div class="col-md-6 mb-3">\n                <h5>Status:</h5>\n                <span class="badge ').concat(s(a.warning_status),' text-dark">').concat(a.warning_status||"-",'</span>\n            </div>\n            <div class="col-md-6 mb-2">\n                <h5>Waktu Pengukuran:</h5>\n                <p class="mb-0 text-muted">').concat(c(a.reading_at),"</p>\n            </div>"),document.getElementById("info-panel").innerHTML=r,t.n=5;break;case 4:t.p=4,o=t.v,console.error("Error:",o),document.getElementById("info-panel").innerHTML='<p class="text-danger">Gagal memuat data.</p>';case 5:return t.a(2)}},t,null,[[0,4]])}))).apply(this,arguments)}function l(){return(l=r(e().m(function n(){var a,r,o,i,l,s,c,d,u;return e().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,fetch("/Home/GetLastGrafik");case 1:return a=e.v,e.n=2,a.json();case 2:if(r=e.v,o=new Date,i=new Date(o.getFullYear(),o.getMonth(),o.getDate()),0!==(l=r.filter(function(t){var e=new Date(t.reading_at);return e>=i&&e<=o}).sort(function(t,e){return new Date(t.reading_at)-new Date(e.reading_at)})).length){e.n=3;break}return console.warn("Tidak ada data hari ini."),e.a(2);case 3:s=l.map(function(t){return new Date(t.reading_at).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}),c=l.map(function(t){return parseFloat(t.water_level)}),d=null!=l[0].siaga1?parseFloat(l[0].siaga1):135,console.log("Nilai siaga:",d),Highcharts.chart("chartTMA",{chart:{type:"line"},title:{text:""},xAxis:{categories:s,title:{text:"Jam"}},yAxis:{title:{text:"TMA (m)"},min:Math.min.apply(Math,t(c).concat([d]))-.2,max:Math.max.apply(Math,t(c).concat([d]))+.2,plotLines:[{value:d,color:"orange",dashStyle:"ShortDash",width:2,label:{text:"Batas Siaga",align:"right",style:{color:"orange",fontWeight:"bold"}}}]},series:[{name:"TMA",data:c,color:"#007bff"}],credits:{enabled:!1}}),e.n=5;break;case 4:e.p=4,u=e.v,console.error("Gagal memuat grafik TMA:",u);case 5:return e.a(2)}},n,null,[[0,4]])}))).apply(this,arguments)}function s(t){switch((t||"").toLowerCase()){case"normal":return"bg-success text-dark";case"siaga 1":return"bg-danger text-dark";case"siaga 2":return"bg-orange";case"siaga 3":return"bg-warning";default:return"bg-secondary"}}function c(t){if(!t)return"-";var e=new Date(t),n=e.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",timeZone:"Asia/Jakarta"}),a=e.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Jakarta"}).replace(".",":");return"".concat(n," ").concat(a," WIB")}return $(document).ready(function(){!function(){i.apply(this,arguments)}(),function(){l.apply(this,arguments)}(),fetch("/Home/GetLastReadingMap").then(function(t){if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(function(t){var e;console.log("Respon API:",t);var n=t;n&&200===(null===(e=n.metaData)||void 0===e?void 0:e.code)&&($.each(n.response,function(t,e){if(null!=e.latitude&&null!=e.longitude){var n,a=new google.maps.Marker({position:{lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)},map,title:e.name,icon:{url:"img/awlr-marker.png",scaledSize:new google.maps.Size(35,50),anchor:new google.maps.Point(16,32)}});n=null!=e.siaga1&&null!=e.siaga2&&null!=e.siaga3?'\n                            <div class="progress-meter mt-2 mb-2">\n                                <div class="meter meter-normal meter-left" style="width: 25%;" title="Normal <br> < 6 m"><span class="fw-normal meter-text" style="color: #4DC27E;">0</span></div>\n                                <div class="meter meter-waspada meter-left" style="width: 25%;" title="Siaga 3 <br> '.concat(e.siaga3," ").concat(e.unit_display," - ").concat(e.siaga2," ").concat(e.unit_display,'"><span class="fw-normal meter-text" style="color: #FFDA4F;">').concat(e.siaga3," ").concat(e.unit_display,'</span></div>\n                                <div class="meter meter-siaga meter-left" style="width: 25%;" title="Siaga 2 <br> ').concat(e.siaga2," ").concat(e.unit_display," - ").concat(e.siaga1," ").concat(e.unit_display,'"><span class="fw-normal meter-text" style="color: #FFA600;">').concat(e.siaga2," ").concat(e.unit_display,'</span></div>\n                                <div class="meter meter-awas meter-left" style="width: 25%;" title="Siaga 1 <br> > ').concat(e.siaga1," ").concat(e.unit_display,'"><span class="fw-normal meter-text" style="color: #EF5350;">').concat(e.siaga1," ").concat(e.unit_display,"</span></div>\n                            </div>\n                        "):'<div class="progress-meter mt-2 mb-2">\n                            <div class="meter meter-normal meter-left" style="width: 25%;" title="Normal <br> < 6 m"><span class="fw-normal meter-text" style="color: #4DC27E;">0</span></div>\n                            <div class="meter meter-waspada meter-left" style="width: 25%;" title="Siaga 3 <br> 0 - 0"><span class="fw-normal meter-text" style="color: #FFDA4F;">0</span></div>\n                            <div class="meter meter-siaga meter-left" style="width: 25%;" title="Siaga 2 <br> 0 - 0"><span class="fw-normal meter-text" style="color: #FFA600;">0</span></div>\n                            <div class="meter meter-awas meter-left" style="width: 25%;" title="Siaga 1 <br> > 0"><span class="fw-normal meter-text" style="color: #EF5350;">0</span></div>\n                        </div>';var r='<div style="font-family: \'Arial\', sans-serif;\n                            max-width: 280px;\n                            font-size: 13px;\n                            padding: 0;\n                            margin: 0;\n                            line-height: 1.3;">\n                            <div style="font-size: 15px;\n                                font-weight: bold;\n                                margin: 0;\n                                padding: 0;\n                                line-height: 1;">\n                                '.concat(e.name||"Tanpa Nama",'\n                            </div><br>\n\n                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 6px;">\n                                <tr>\n                                    <td style="color: #555;">Device</td>\n                                    <td style="text-align: right;">\n                                        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 6px;">\n                                            <span>').concat(e.brand_name||"-",'</span>\n                                            <span style="\n                                                display: inline-block;\n                                                background-color: #ffc107;\n                                                color: #000;\n                                                font-size: 11px;\n                                                padding: 2px 6px;\n                                                border-radius: 6px;\n                                            ">\n                                                ').concat(e.device_id||"-",'\n                                            </span>\n                                        </div>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">Koordinat</td>\n                                    <td style="text-align: right; padding-left: 8px;">\n                                        ').concat(parseFloat(e.latitude).toFixed(6),", ").concat(parseFloat(e.longitude).toFixed(6),'\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">Status</td>\n                                    <td style="text-align: right;">\n                                        <span style="\n                                            display: inline-block;\n                                            padding: 2px 6px;\n                                            font-size: 12px;\n                                            border-radius: 6px;\n                                            background-color: ').concat("online"===e.status?"#28a745":"#6c757d",';\n                                            color: white;\n                                        ">\n                                            ').concat("online"===e.status?"Online":"No Data",'\n                                        </span>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">Elevasi</td>\n                                    <td style="text-align: right; font-weight: bold; font-size: 14px;">\n                                        ').concat(parseFloat(e.water_level||0).toFixed(1)," cm\n                                    </td>\n                                </tr>\n                            </table>\n\n                            ").concat(n,'<br>\n\n                            <div style="display: flex; align-items: center; font-size: 12px; color: #555;">\n                                <i class="far fa-clock" style="margin-right: 6px;"></i>\n                                ').concat(moment(e.reading_at).locale("id").format("YYYY-MM-DD HH:mm:ss"),"\n                            </div>\n                        </div>"),o=new google.maps.InfoWindow({content:r});a.addListener("click",function(){o.open(map,a)}),google.maps.event.addListener(o,"domready",function(){setTimeout(function(){var t=document.querySelector(".gm-style-iw");if(t){t.style.padding="0px",t.style.margin="0px";var e=t.parentElement;e&&(e.style.padding="0px",e.style.margin="0px");var n=null==e?void 0:e.parentElement;n&&(n.style.padding="0px",n.style.marginTop="0px")}var a=document.querySelector(".gm-style-iw-d");a&&(a.style.margin="0px",a.style.padding="0px")},50)})}}),setTimeout(adjustPadding,100))}).catch(function(t){console.log(t)})}),{}})());