function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _regenerator(){var g,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function a(e,t,n,a){var r,o,i,l,s,c,d,u,p,t=t&&t.prototype instanceof y?t:y,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(r=e,o=n,d=a||[],u=!1,p={p:c=0,n:0,v:g,a:f,f:f.bind(g,4),d:function(e,t){return i=e,l=0,s=g,p.n=t,m}},function(e,t,n){if(1<c)throw TypeError("Generator is already running");for(u&&1===t&&f(t,n),l=t,s=n;(b=l<2?g:s)||!u;){i||(l?l<3?(1<l&&(p.n=-1),f(l,s)):p.n=s:p.v=s);try{if(c=2,i){if(b=i[e=l?e:"next"]){if(!(b=b.call(i,s)))throw TypeError("iterator result is not an object");if(!b.done)return b;s=b.value,l<2&&(l=0)}else 1===l&&(b=i.return)&&b.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+e+"' method"),l=1);i=g}else if((b=(u=p.n<0)?s:r.call(o,p))!==m)break}catch(e){i=g,l=1,s=e}finally{c=1}}return{value:b,done:u}}),!0),t;function f(e,t){for(l=e,s=t,b=0;!u&&c&&!n&&b<d.length;b++){var n,a=d[b],r=p.p,o=a[2];3<e?(n=o===t)&&(s=a[(l=a[4])?5:l=3],a[4]=a[5]=g):a[0]<=r&&((n=e<2&&r<a[1])?(l=0,p.v=t,p.n=a[1]):r<o&&(n=e<3||a[0]>t||o<t)&&(a[4]=e,a[5]=t,p.n=o,l=0))}if(n||1<e)return m;throw u=!0,t}}var m={};function y(){}function r(){}function o(){}var b=Object.getPrototypeOf,e=[][t]?b(b([][t]())):(_regeneratorDefine2(b={},t,function(){return this}),b),i=o.prototype=y.prototype=Object.create(e);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",r.prototype=o),_regeneratorDefine2(o,"constructor",r),_regeneratorDefine2(o,n,r.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,n,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:l}})()}function _regeneratorDefine2(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}(_regeneratorDefine2=function(e,t,n,a){t?r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:((a=function(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})})("next",0),a("throw",1),a("return",2))})(e,t,n,a)}function asyncGeneratorStep(e,t,n,a,r,o,i){try{var l=e[o](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,r)}function _asyncToGenerator(l){return function(){var e=this,i=arguments;return new Promise(function(t,n){var a=l.apply(e,i);function r(e){asyncGeneratorStep(a,t,n,r,o,"next",e)}function o(e){asyncGeneratorStep(a,t,n,r,o,"throw",e)}r(void 0)})}}function _createForOfIteratorHelper(e,t){var n,a,r,o,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return r=!(a=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){r=!0,n=e},f:function(){try{a||null==i.return||i.return()}finally{if(r)throw n}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}var map;function initMap(){var e={lat:-6.9175,lng:107.6191};map=new google.maps.Map(document.getElementById("map"),{zoom:10,center:e,gestureHandling:"greedy",mapTypeId:google.maps.MapTypeId.HYBRID,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_LEFT},styles:[{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"labels",stylers:[{visibility:"on"}]}]}),(new google.maps.Geocoder).geocode({location:e},function(e,t){if("OK"===t&&e[0]){var n,a="",r=_createForOfIteratorHelper(e[0].address_components);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(o.types.includes("administrative_area_level_1")){a=o.long_name;break}}}catch(e){r.e(e)}finally{r.f()}new google.maps.InfoWindow({content:"<strong>".concat(a,"</strong>")}).open(map)}})}function loadAwlrPanel(){return _loadAwlrPanel.apply(this,arguments)}function _loadAwlrPanel(){return(_loadAwlrPanel=_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,fetch("/Home/GetLatestReading");case 1:if((t=e.v).ok){e.n=2;break}throw new Error("Gagal memuat data");case 2:return e.n=3,t.json();case 3:n=e.v,n='<div class="col-md-4 mb-3">\n                <h5>Nama Pos:</h5>\n                <p class="mb-1 fw-semibold">'.concat(n.name||"-",'</p>\n            </div>\n            <div class="col-md-4 mb-3">\n                <h5>Device:</h5>\n                <p class="mb-1 fw-semibold">').concat(n.brand_name||"-",' <span class="badge bg-warning text-dark">').concat(n.device_id||"-",'</span></p>\n            </div>\n            <div class="col-md-4 mb-3">\n                <h5>Tinggi Muka Air (TMA):</h5>\n                <p class="mb-1 text-primary fw-semibold">').concat(parseFloat(n.water_level).toFixed(2),' cm</p>\n            </div>\n            <div class="col-md-6 mb-3">\n                <h5>Status:</h5>\n                <span class="badge ').concat(getStatusBadgeClass(n.warning_status),' text-dark">').concat(n.warning_status||"-",'</span>\n            </div>\n            <div class="col-md-6 mb-2">\n                <h5>Waktu Pengukuran:</h5>\n                <p class="mb-0 text-muted">').concat(formatDate(n.reading_at),"</p>\n            </div>"),document.getElementById("info-panel").innerHTML=n,e.n=5;break;case 4:e.p=4,n=e.v,console.error("Error:",n),document.getElementById("info-panel").innerHTML='<p class="text-danger">Gagal memuat data.</p>';case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function loadChartTMA(){return _loadChartTMA.apply(this,arguments)}function _loadChartTMA(){return(_loadChartTMA=_asyncToGenerator(_regenerator().m(function e(){var t,n,a,r,o,i,l;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,fetch("/Home/GetLastGrafik");case 1:return t=e.v,e.n=2,t.json();case 2:if(t=e.v,n=new Date,a=new Date(n.getFullYear(),n.getMonth(),n.getDate()),0===(r=t.filter(function(e){e=new Date(e.reading_at);return a<=e&&e<=n}).sort(function(e,t){return new Date(e.reading_at)-new Date(t.reading_at)})).length)return console.warn("Tidak ada data hari ini."),e.a(2);e.n=3;break;case 3:l=r.map(function(e){return new Date(e.reading_at).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}),o=r.map(function(e){return parseFloat(e.water_level)}),i=null!=r[0].siaga1?parseFloat(r[0].siaga1):135,Highcharts.chart("chartTMA",{chart:{type:"line"},title:{text:""},xAxis:{categories:l,title:{text:"Jam"}},yAxis:{title:{text:"TMA (m)"},min:Math.min.apply(Math,_toConsumableArray(o).concat([i]))-.2,max:Math.max.apply(Math,_toConsumableArray(o).concat([i]))+.2,plotLines:[{value:i,color:"orange",dashStyle:"ShortDash",width:2,label:{text:"Batas Siaga",align:"right",style:{color:"orange",fontWeight:"bold"}}}]},series:[{name:"TMA",data:o,color:"#007bff"}],credits:{enabled:!1}}),e.n=5;break;case 4:e.p=4,l=e.v,console.error("Gagal memuat grafik TMA:",l);case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function loadAwlrLastReading(){getData("/Home/GetLastReadingMap").then(function(e){var t;e&&200===(null==(t=e.data.metaData)?void 0:t.code)&&($.each(e.data.response,function(e,t){var n,a,r,o;t.latitude&&t.longitude&&(n=new google.maps.Marker({position:{lat:parseFloat(t.latitude),lng:parseFloat(t.longitude)},map:map,title:t.name,icon:{url:"img/duga.png",scaledSize:new google.maps.Size(40,50),anchor:new google.maps.Point(16,32)}}),a='\n                        <div class="progress-meter mt-2 mb-2">\n                            <div class="meter meter-normal meter-left" style="width: 25%;" title="Normal <br> < 6 m">\n                                <span class="fw-normal meter-text" style="color: #4DC27E;">0</span>\n                            </div>\n                            <div class="meter meter-waspada meter-left" style="width: 25%;" title="Siaga 3 <br> '.concat(t.siaga3||0," cm - ").concat(t.siaga2||0,' cm">\n                                <span class="fw-normal meter-text" style="color: #FFDA4F;">').concat(t.siaga3||0,' cm</span>\n                            </div>\n                            <div class="meter meter-siaga meter-left" style="width: 25%;" title="Siaga 2 <br> ').concat(t.siaga2||0," cm - ").concat(t.siaga1||0,' cm">\n                                <span class="fw-normal meter-text" style="color: #FFA600;">').concat(t.siaga2||0,' cm</span>\n                            </div>\n                            <div class="meter meter-awas meter-left" style="width: 25%;" title="Siaga 1 <br> > ').concat(t.siaga1||0,' cm">\n                                <span class="fw-normal meter-text" style="color: #EF5350;">').concat(t.siaga1||0," cm</span>\n                            </div>\n                        </div>\n                    "),"Normal"==t.status?r="bg-success":"Siaga 3"==t.status?r="bg-warning":"Siaga 2"==t.status?r="bg-orange":"Siaga 1"==t.status&&(r="bg-danger"),r='\n                        <div style="font-family: \'Arial\', sans-serif;\n                                    max-width: 350px;\n                                    font-size: 13px;\n                                    text-align: left;\n                                    padding: 0;\n                                    margin: 0;\n                                    line-height: 1.4;">\n\n                            \x3c!-- Judul --\x3e\n                            <div style="font-size: 16px;\n                                        font-weight: bold;\n                                        text-align: left;\n                                        margin: 0 0 6px 0;">\n                                '.concat(t.name||"Tanpa Nama",'\n                            </div>\n\n                            \x3c!-- Tabel Info --\x3e\n                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 8px;">\n                                <tr>\n                                    <td style="color: #555;">Device</td>\n                                    <td style="text-align: right;">\n                                        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 6px;">\n                                            <span>').concat(t.brand_name||"-",'</span>\n                                            <span style="\n                                                display: inline-block;\n                                                background-color: #ffc107;\n                                                color: #000;\n                                                font-size: 11px;\n                                                padding: 2px 6px;\n                                                border-radius: 6px;\n                                            ">\n                                                ').concat(t.device_id||"-",'\n                                            </span>\n                                        </div>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">Koordinat</td>\n                                    <td style="text-align: right; padding-left: 8px;">\n                                        ').concat(parseFloat(t.latitude).toFixed(6),", ").concat(parseFloat(t.longitude).toFixed(6),'\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">Status</td>\n                                    <td style="text-align: right;">\n                                        <span style="\n                                            display: inline-block;\n                                            padding: 2px 6px;\n                                            font-size: 12px;\n                                            border-radius: 6px;\n                                            color: white;"\n                                            class="').concat(r,'">\n                                            ').concat(t.status,'\n                                        </span>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">TMA</td>\n                                    <td style="text-align: right; font-weight: bold; font-size: 14px;">\n                                        ').concat(parseFloat(t.water_level||0).toFixed(1)," cm\n                                    </td>\n                                </tr>\n                            </table>\n\n                            \x3c!-- Progress Meter --\x3e\n                            ").concat(a,'<br>\n\n                            \x3c!-- Waktu --\x3e\n                            <div style="display: flex; align-items: center; font-size: 12px; color: #555; margin-top: 4px;">\n                                <i class="far fa-clock" style="margin-right: 6px;"></i>\n                                ').concat(moment(t.reading_at).locale("id").format("YYYY-MM-DD HH:mm"),'\n                            </div>\n\n                            <div style="text-align: center; margin-top: 10px;">\n                                <a href="/Home/StationDetail" class="btn btn-info btn-sm" style="display: block; width: 100%; border-radius: 25px;">Lihat Detail</a>\n                            </div>\n                        </div>\n                    '),o=new google.maps.InfoWindow({content:r}),n.addListener("click",function(){o.open(map,n)}))}),setTimeout(adjustPadding,100))}).catch(function(e){console.log(e)})}function getStatusBadgeClass(e){switch((e||"").toLowerCase()){case"normal":return"bg-success text-dark";case"siaga 1":return"bg-danger text-dark";case"siaga 2":return"bg-orange";case"siaga 3":return"bg-warning";default:return"bg-secondary"}}function formatDate(e){var t;return e?(t=(e=new Date(e)).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",timeZone:"Asia/Jakarta"}),e=e.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Jakarta"}).replace(".",":"),"".concat(t," ").concat(e," WIB")):"-"}function getData(e){return fetch(e).then(function(e){if(e.ok)return e.json();throw new Error("Network response was not ok")})}function adjustPadding(){var e=document.querySelectorAll(".footer"),n=document.querySelectorAll(".tab-pane");e.forEach(function(e,t){t=n[t];e&&t&&(e=e.offsetHeight,t.style.paddingBottom="".concat(e,"px"))})}$(document).ready(function(){loadAwlrPanel(),loadChartTMA(),loadAwlrLastReading()});