/*! For license information please see Home.js.LICENSE.txt */
!function(t,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var e=n();for(var a in e)("object"==typeof exports?exports:t)[a]=e[a]}}(self,()=>(()=>{var t;function n(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return o(t,n);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(){var t,n,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function s(e,r,i,o){var s=r&&r.prototype instanceof l?r:l,d=Object.create(s.prototype);return a(d,"_invoke",function(e,a,r){var i,o,s,l=0,d=r||[],u=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(n,e){return i=n,o=0,s=t,p.n=e,c}};function f(e,a){for(o=e,s=a,n=0;!u&&l&&!r&&n<d.length;n++){var r,i=d[n],f=p.p,m=i[2];e>3?(r=m===a)&&(s=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=t):i[0]<=f&&((r=e<2&&f<i[1])?(o=0,p.v=a,p.n=i[1]):f<m&&(r=e<3||i[0]>a||a>m)&&(i[4]=e,i[5]=a,p.n=m,o=0))}if(r||e>1)return c;throw u=!0,a}return function(r,d,m){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&f(d,m),o=d,s=m;(n=o<2?t:s)||!u;){i||(o?o<3?(o>1&&(p.n=-1),f(o,s)):p.n=s:p.v=s);try{if(l=2,i){if(o||(r="next"),n=i[r]){if(!(n=n.call(i,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,o<2&&(o=0)}else 1===o&&(n=i.return)&&n.call(i),o<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),o=1);i=t}else if((n=(u=p.n<0)?s:e.call(a,p))!==c)break}catch(n){i=t,o=1,s=n}finally{l=1}}return{value:n,done:u}}}(e,i,o),!0),d}var c={};function l(){}function d(){}function u(){}n=Object.getPrototypeOf;var p=[][i]?n(n([][i]())):(a(n={},i,function(){return this}),n),f=u.prototype=l.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,a(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return d.prototype=u,a(f,"constructor",u),a(u,"constructor",d),d.displayName="GeneratorFunction",a(u,o,"GeneratorFunction"),a(f),a(f,o,"Generator"),a(f,i,function(){return this}),a(f,"toString",function(){return"[object Generator]"}),(e=function(){return{w:s,m}})()}function a(t,n,e,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}a=function(t,n,e,r){if(n)i?i(t,n,{value:e,enumerable:!r,configurable:!r,writable:!r}):t[n]=e;else{var o=function(n,e){a(t,n,function(t){return this._invoke(n,e,t)})};o("next",0),o("throw",1),o("return",2)}},a(t,n,e,r)}function r(t,n,e,a,r,i,o){try{var s=t[i](o),c=s.value}catch(t){return void e(t)}s.done?n(c):Promise.resolve(c).then(a,r)}function i(t){return function(){var n=this,e=arguments;return new Promise(function(a,i){var o=t.apply(n,e);function s(t){r(o,a,i,s,c,"next",t)}function c(t){r(o,a,i,s,c,"throw",t)}s(void 0)})}}function o(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,a=Array(n);e<n;e++)a[e]=t[e];return a}function s(){return(s=i(e().m(function t(){var n,a,r,i,o;return e().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,fetch("/Home/GetLatestReading");case 1:if((n=t.v).ok){t.n=2;break}throw new Error("Gagal memuat data");case 2:return t.n=3,n.json();case 3:a=t.v,r='<div class="col-md-4 mb-3">\n                <h5>Nama Pos:</h5>\n                <p class="mb-1 fw-semibold">'.concat(a.name||"-",'</p>\n            </div>\n            <div class="col-md-4 mb-3">\n                <h5>Device:</h5>\n                <p class="mb-1 fw-semibold">').concat(a.brand_name||"-",' <span class="badge bg-warning text-dark">').concat(a.device_id||"-",'</span></p>\n            </div>\n            <div class="col-md-4 mb-3">\n                <h5>Tinggi Muka Air (TMA):</h5>\n                <p class="mb-1 text-primary fw-semibold">').concat(parseFloat(a.water_level).toFixed(2)," ").concat(a.display,'</p>\n            </div>\n            <div class="col-md-6 mb-3">\n                <h5>Status:</h5>\n                <span class="badge ').concat(l(a.warning_status),' text-dark">').concat(a.warning_status||"-",'</span>\n            </div>\n            <div class="col-md-6 mb-2">\n                <h5>Waktu Pengukuran:</h5>\n                <p class="mb-0 text-muted">').concat(d(a.reading_at),"</p>\n            </div>"),i='<div class="position-relative mb-2" style="height: 20px; background: linear-gradient(to right, #28a745 0%, #ffc107 33%, #fd7e14 66%, #dc3545 100%); border-radius: 10px;"></div>\n            <div class="d-flex justify-content-between small fw-semibold mt-2">\n                <div class="text-success">0</div>\n                <div class="text-warning">'.concat(a.siaga3," ").concat(a.display,'</div>\n                <div class="text-orange" style="color: #fd7e14;">').concat(a.siaga2," ").concat(a.display,'</div>\n                <div class="text-danger">').concat(a.siaga1," ").concat(a.display,'</div>\n            </div>\n            <ul class="list-inline text-center mt-3 mb-0 small text-muted">\n                <li class="list-inline-item">Normal: <span class="text-success fw-bold">Hijau</span></li>\n                <li class="list-inline-item">Waspada: <span class="text-warning fw-bold">Kuning</span></li>\n                <li class="list-inline-item">Siaga: <span style="color: #fd7e14;" class="fw-bold">Oranye</span></li>\n                <li class="list-inline-item">Awas: <span class="text-danger fw-bold">Merah</span></li>\n            </ul>'),document.getElementById("info-panel").innerHTML=r,document.getElementById("siaga").innerHTML=i,t.n=5;break;case 4:t.p=4,o=t.v,console.error("Error:",o),document.getElementById("info-panel").innerHTML='<p class="text-danger">Gagal memuat data.</p>';case 5:return t.a(2)}},t,null,[[0,4]])}))).apply(this,arguments)}function c(){return(c=i(e().m(function t(){var a,r,i,o,s,c,l,d,u;return e().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,fetch("/Home/GetLastGrafik");case 1:return a=t.v,t.n=2,a.json();case 2:if(r=t.v,i=new Date,o=new Date(i.getFullYear(),i.getMonth(),i.getDate()),0!==(s=r.filter(function(t){var n=new Date(t.reading_at);return n>=o&&n<=i}).sort(function(t,n){return new Date(t.reading_at)-new Date(n.reading_at)})).length){t.n=3;break}return console.warn("Tidak ada data hari ini."),t.a(2);case 3:c=s.map(function(t){return new Date(t.reading_at).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}),l=s.map(function(t){return parseFloat(t.water_level)}),d=null!=s[0].siaga1?parseFloat(s[0].siaga1):135,Highcharts.chart("chartTMA",{chart:{type:"line"},title:{text:""},xAxis:{categories:c,title:{text:"Jam"}},yAxis:{title:{text:"TMA (m)"},min:Math.min.apply(Math,n(l).concat([d]))-.2,max:Math.max.apply(Math,n(l).concat([d]))+.2,plotLines:[{value:d,color:"orange",dashStyle:"ShortDash",width:2,label:{text:"Batas Siaga",align:"right",style:{color:"orange",fontWeight:"bold"}}}]},series:[{name:"TMA",data:l,color:"#007bff"}],credits:{enabled:!1}}),t.n=5;break;case 4:t.p=4,u=t.v,console.error("Gagal memuat grafik TMA:",u);case 5:return t.a(2)}},t,null,[[0,4]])}))).apply(this,arguments)}function l(t){switch((t||"").toLowerCase()){case"normal":return"bg-success text-dark";case"siaga 1":return"bg-danger text-dark";case"siaga 2":return"bg-orange";case"siaga 3":return"bg-warning";default:return"bg-secondary"}}function d(t){if(!t)return"-";var n=new Date(t),e=n.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",timeZone:"Asia/Jakarta"}),a=n.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Jakarta"}).replace(".",":");return"".concat(e," ").concat(a," WIB")}function u(){var t=document.querySelectorAll(".footer"),n=document.querySelectorAll(".tab-pane");t.forEach(function(t,e){var a=n[e];if(t&&a){var r=t.offsetHeight;a.style.paddingBottom="".concat(r,"px")}})}return $(document).ready(function(){!function(){s.apply(this,arguments)}(),function(){c.apply(this,arguments)}(),fetch("/Home/GetLastReadingMap").then(function(t){if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(function(n){var e,a=n;a&&200===(null===(e=a.data.metaData)||void 0===e?void 0:e.code)&&($.each(a.data.response,function(n,e){if(e.latitude&&e.longitude){var a,r=new google.maps.Marker({position:{lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)},map:t,title:e.name,icon:{url:"img/duga.png",scaledSize:new google.maps.Size(40,50),anchor:new google.maps.Point(16,32)}}),i='\n                        <div class="progress-meter mt-2 mb-2">\n                            <div class="meter meter-normal meter-left" style="width: 25%;" title="Normal <br> < 6 m">\n                                <span class="fw-normal meter-text" style="color: #4DC27E;">0</span>\n                            </div>\n                            <div class="meter meter-waspada meter-left" style="width: 25%;" title="Siaga 3 <br> '.concat(e.siaga3||0," cm - ").concat(e.siaga2||0,' cm">\n                                <span class="fw-normal meter-text" style="color: #FFDA4F;">').concat(e.siaga3||0,' cm</span>\n                            </div>\n                            <div class="meter meter-siaga meter-left" style="width: 25%;" title="Siaga 2 <br> ').concat(e.siaga2||0," cm - ").concat(e.siaga1||0,' cm">\n                                <span class="fw-normal meter-text" style="color: #FFA600;">').concat(e.siaga2||0,' cm</span>\n                            </div>\n                            <div class="meter meter-awas meter-left" style="width: 25%;" title="Siaga 1 <br> > ').concat(e.siaga1||0,' cm">\n                                <span class="fw-normal meter-text" style="color: #EF5350;">').concat(e.siaga1||0," cm</span>\n                            </div>\n                        </div>\n                    ");"Normal"==e.status?a="bg-success":"Siaga 3"==e.status?a="bg-warning":"Siaga 2"==e.status?a="bg-orange":"Siaga 1"==e.status&&(a="bg-danger");var o='\n                        <div style="font-family: \'Arial\', sans-serif;\n                                    max-width: 350px;\n                                    font-size: 13px;\n                                    text-align: left;\n                                    padding: 0;\n                                    margin: 0;\n                                    line-height: 1.4;">\n\n                            \x3c!-- Judul --\x3e\n                            <div style="font-size: 16px;\n                                        font-weight: bold;\n                                        text-align: left;\n                                        margin: 0 0 6px 0;">\n                                '.concat(e.name||"Tanpa Nama",'\n                            </div>\n\n                            \x3c!-- Tabel Info --\x3e\n                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 8px;">\n                                <tr>\n                                    <td style="color: #555;">Device</td>\n                                    <td style="text-align: right;">\n                                        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 6px;">\n                                            <span>').concat(e.brand_name||"-",'</span>\n                                            <span style="\n                                                display: inline-block;\n                                                background-color: #ffc107;\n                                                color: #000;\n                                                font-size: 11px;\n                                                padding: 2px 6px;\n                                                border-radius: 6px;\n                                            ">\n                                                ').concat(e.device_id||"-",'\n                                            </span>\n                                        </div>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">Koordinat</td>\n                                    <td style="text-align: right; padding-left: 8px;">\n                                        ').concat(parseFloat(e.latitude).toFixed(6),", ").concat(parseFloat(e.longitude).toFixed(6),'\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">Status</td>\n                                    <td style="text-align: right;">\n                                        <span style="\n                                            display: inline-block;\n                                            padding: 2px 6px;\n                                            font-size: 12px;\n                                            border-radius: 6px;\n                                            color: white;"\n                                            class="').concat(a,'">\n                                            ').concat(e.status,'\n                                        </span>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">TMA</td>\n                                    <td style="text-align: right; font-weight: bold; font-size: 14px;">\n                                        ').concat(parseFloat(e.water_level||0).toFixed(1)," cm\n                                    </td>\n                                </tr>\n                            </table>\n\n                            \x3c!-- Progress Meter --\x3e\n                            ").concat(i,'<br>\n\n                            \x3c!-- Waktu --\x3e\n                            <div style="display: flex; align-items: center; font-size: 12px; color: #555; margin-top: 4px;">\n                                <i class="far fa-clock" style="margin-right: 6px;"></i>\n                                ').concat(moment(e.reading_at).locale("id").format("YYYY-MM-DD HH:mm"),'\n                            </div>\n\n                            <div style="text-align: center; margin-top: 10px;">\n                                <a href="/Home/StationDetail" class="btn btn-info btn-sm" style="display: block; width: 100%; border-radius: 25px;">Lihat Detail</a>\n                            </div>\n                        </div>\n                    '),s=new google.maps.InfoWindow({content:o});r.addListener("click",function(){s.open(t,r)})}}),setTimeout(u,100))}).catch(function(t){console.log(t)})}),{}})());