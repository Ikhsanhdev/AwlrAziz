"use strict";moment.locale("id");var lastReadingDateRaw=getLastReadingDate().lastReading,LAST_READING_DATE=lastReadingDateRaw?moment(lastReadingDateRaw).format("DD MMMM YYYY"):moment().format("DD MMMM YYYY"),LAST_READING_DATE_RAW=lastReadingDateRaw?moment(lastReadingDateRaw).format("YYYY-MM-DD"):moment().format("YYYY-MM-DD");function generateDataTable(e,a,t){var r=[{title:"Tanggal Baca",data:"readingAt",class:"text-center",render:function(e){return moment(e).locale("id").format("DD MMMM YYYY")}},{title:"Jam",data:"readingAt",class:"text-center",render:function(e){return moment.parseZone(e).format("HH:mm")}},{title:"Tinggi Muka Air (m)",data:"waterLevel",class:"text-center",render:function(e){return"".concat(e.toFixed(2)," m")}}];$.fn.DataTable.isDataTable("#table-telemetri")&&$("#table-telemetri").DataTable().clear().destroy(),$("#table-telemetri").DataTable({dom:"lrtip",scrollY:"400px",processing:!0,serverSide:!1,scrollCollapse:!0,paging:!0,ajax:{url:"/Home/GetDataTableAwlr?periode=".concat(e,"&periodEnd=").concat(a),type:"GET",dataSrc:""},columns:r,responsive:!0,language:{url:"//cdn.datatables.net/plug-ins/1.13.4/i18n/id.json"},order:[[0,"desc"]],pageLength:10,initComplete:function(){t&&"function"==typeof t&&t()}})}function renderChartFromTable(e,a){var t,r=moment(e),n=moment(a).endOf("day"),o=$("#table-telemetri").DataTable().rows().data().toArray(),i=[];o.forEach(function(e){var a=moment.parseZone(e.readingAt);a.isBetween(r,n,null,"[]")&&i.push([a.valueOf(),parseFloat(e.waterLevel)])}),i.sort(function(e,a){return e[0]-a[0]}),t=e==a?"Periode: ".concat(moment(e).locale("id").format("DD MMMM YYYY")):"Periode: ".concat(moment(e).locale("id").format("DD MMMM YYYY")," - ").concat(moment(a).locale("id").format("DD MMMM YYYY")),Highcharts.stockChart("container",{chart:{type:"areaspline",zoomType:"x",spacingTop:20,spacingBottom:20,scrollablePlotArea:{minWidth:1200,scrollPositionX:0}},navigation:{buttonOptions:{enabled:!1}},rangeSelector:{enabled:!1},title:{text:"Grafik Tinggi Muka Air",style:{fontSize:"16px",fontWeight:"bold"}},subtitle:{text:t,style:{fontSize:"13px",color:"#666"}},xAxis:{type:"datetime",title:{text:"Tanggal"},labels:{format:"{value:%d %b %Y %H:%M}",rotation:-45,align:"right"}},yAxis:{title:{text:"Tinggi Muka Air (cm)"},opposite:!1,labels:{format:"{value} cm",style:{fontSize:"12px"}},gridLineDashStyle:"Dash",lineWidth:1,lineColor:"#999",tickColor:"#999"},tooltip:{shared:!0,useHTML:!0,formatter:function(){var e="<b>".concat(Highcharts.dateFormat("%A, %d %B %Y %H:%M",this.x),"</b><br/>");return this.points.forEach(function(a){e+='<span style="color:'.concat(a.color,'">‚óè</span> ').concat(a.series.name,": <b>").concat(a.y.toFixed(2)," cm</b><br/>")}),e}},plotOptions:{series:{marker:{enabled:!0,radius:4},lineWidth:2,states:{hover:{lineWidth:3}}},areaspline:{fillOpacity:.3}},series:[{name:"TMA",data:i.map(function(e){return[new Date(e[0]).getTime(),e[1]]})}],credits:{enabled:!1},exporting:{enabled:!0}})}function getLastReadingDate(){var e;return $.ajax({url:"/Home/GetLastReadingDate?deviceId=MAA1",type:"GET",async:!1,success:function(a){var t=moment.parseZone(a.lastReading);t.hour();e=t.format("YYYY-MM-DD")},error:function(a,t,r){console.error("Error:",t,r),e=null}}),e}$(document).ready(function(){document.getElementById("periode").placeholder=LAST_READING_DATE,document.getElementById("periode-end").placeholder=LAST_READING_DATE,document.getElementById("periode-grafik").placeholder=LAST_READING_DATE,document.getElementById("periode-grafik-end").placeholder=LAST_READING_DATE,flatpickr("#periode",{dateFormat:"Y-m-d",altInput:!0,altFormat:"d F Y",locale:"id",defaultDate:LAST_READING_DATE_RAW,maxDate:"today",disableMobile:!0}),flatpickr("#periode-end",{dateFormat:"Y-m-d",altInput:!0,altFormat:"d F Y",locale:"id",defaultDate:LAST_READING_DATE_RAW,maxDate:"today",disableMobile:!0}),flatpickr("#periode-grafik",{dateFormat:"Y-m-d",altInput:!0,altFormat:"d F Y",locale:"id",defaultDate:LAST_READING_DATE_RAW,maxDate:"today",disableMobile:!0}),flatpickr("#periode-grafik-end",{dateFormat:"Y-m-d",altInput:!0,altFormat:"d F Y",locale:"id",defaultDate:LAST_READING_DATE_RAW,maxDate:"today",disableMobile:!0});var e=$("#periode").val(),a=$("#periode-end").val(),t=$("#periode-grafik").val(),r=$("#periode-grafik-end").val();generateDataTable(e,a,function(){renderChartFromTable(t,r)}),$("#periode").on("change",function(){generateDataTable($(this).val(),a)}),$("#periode-end").on("change",function(){var a=$(this).val();generateDataTable(e,a)}),$("#periode-grafik").on("change",function(){var e=$(this).val(),a=$("#periode-grafik-end").val();generateDataTable(e,a,function(){renderChartFromTable(e,a)})}),$("#periode-grafik-end").on("change",function(){var e=$("#periode-grafik").val(),a=$(this).val();generateDataTable(e,a,function(){renderChartFromTable(e,a)})})});