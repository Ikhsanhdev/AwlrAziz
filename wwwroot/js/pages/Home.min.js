"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,a,r,o){var s=a&&a.prototype instanceof l?a:l,c=Object.create(s.prototype);return _regeneratorDefine2(c,"_invoke",function(n,a,r){var o,l,s,c=0,d=r||[],u=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return o=t,l=0,s=e,p.n=n,i}};function f(n,a){for(l=n,s=a,t=0;!u&&c&&!r&&t<d.length;t++){var r,o=d[t],f=p.p,g=o[2];n>3?(r=g===a)&&(s=o[(l=o[4])?5:(l=3,3)],o[4]=o[5]=e):o[0]<=f&&((r=n<2&&f<o[1])?(l=0,p.v=a,p.n=o[1]):f<g&&(r=n<3||o[0]>a||a>g)&&(o[4]=n,o[5]=a,p.n=g,l=0))}if(r||n>1)return i;throw u=!0,a}return function(r,d,g){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&f(d,g),l=d,s=g;(t=l<2?e:s)||!u;){o||(l?l<3?(l>1&&(p.n=-1),f(l,s)):p.n=s:p.v=s);try{if(c=2,o){if(l||(r="next"),t=o[r]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=o.return)&&t.call(o),l<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),l=1);o=e}else if((t=(u=p.n<0)?s:n.call(a,p))!==i)break}catch(t){o=e,l=1,s=t}finally{c=1}}return{value:t,done:u}}}(n,r,o),!0),c}var i={};function l(){}function s(){}function c(){}t=Object.getPrototypeOf;var d=[][a]?t(t([][a]())):(_regeneratorDefine2(t={},a,function(){return this}),t),u=c.prototype=l.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(u),e}return s.prototype=c,_regeneratorDefine2(u,"constructor",c),_regeneratorDefine2(c,"constructor",s),s.displayName="GeneratorFunction",_regeneratorDefine2(c,r,"GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,r,"Generator"),_regeneratorDefine2(u,a,function(){return this}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:p}})()}function _regeneratorDefine2(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}(_regeneratorDefine2=function(e,t,n,a){if(t)r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n;else{var o=function(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})};o("next",0),o("throw",1),o("return",2)}})(e,t,n,a)}function asyncGeneratorStep(e,t,n,a,r,o,i){try{var l=e[o](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var o=e.apply(t,n);function i(e){asyncGeneratorStep(o,a,r,i,l,"next",e)}function l(e){asyncGeneratorStep(o,a,r,i,l,"throw",e)}i(void 0)})}}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}var map;function initMap(){var e={lat:-6.9175,lng:107.6191};map=new google.maps.Map(document.getElementById("map"),{zoom:10,center:e,gestureHandling:"greedy",mapTypeId:google.maps.MapTypeId.HYBRID,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_LEFT},styles:[{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"labels",stylers:[{visibility:"on"}]}]}),(new google.maps.Geocoder).geocode({location:e},function(e,t){if("OK"===t&&e[0]){var n,a="",r=_createForOfIteratorHelper(e[0].address_components);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(o.types.includes("administrative_area_level_1")){a=o.long_name;break}}}catch(e){r.e(e)}finally{r.f()}new google.maps.InfoWindow({content:"<strong>".concat(a,"</strong>")}).open(map)}})}function loadAwlrPanel(){return _loadAwlrPanel.apply(this,arguments)}function _loadAwlrPanel(){return(_loadAwlrPanel=_asyncToGenerator(_regenerator().m(function e(){var t,n,a,r,o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,fetch("/Home/GetLatestReading");case 1:if((t=e.v).ok){e.n=2;break}throw new Error("Gagal memuat data");case 2:return e.n=3,t.json();case 3:n=e.v,a='<div class="col-md-4 mb-3">\n                <h5>Nama Pos:</h5>\n                <p class="mb-1 fw-semibold">'.concat(n.name||"-",'</p>\n            </div>\n            <div class="col-md-4 mb-3">\n                <h5>Device:</h5>\n                <p class="mb-1 fw-semibold">').concat(n.brand_name||"-",' <span class="badge bg-warning text-dark">').concat(n.device_id||"-",'</span></p>\n            </div>\n            <div class="col-md-4 mb-3">\n                <h5>Tinggi Muka Air (TMA):</h5>\n                <p class="mb-1 text-primary fw-semibold">').concat(parseFloat(n.water_level).toFixed(2)," ").concat(n.display,'</p>\n            </div>\n            <div class="col-md-6 mb-3">\n                <h5>Status:</h5>\n                <span class="badge ').concat(getStatusBadgeClass(n.warning_status),' text-dark">').concat(n.warning_status||"-",'</span>\n            </div>\n            <div class="col-md-6 mb-2">\n                <h5>Waktu Pengukuran:</h5>\n                <p class="mb-0 text-muted">').concat(formatDate(n.reading_at),"</p>\n            </div>"),r='<div class="position-relative mb-2" style="height: 20px; background: linear-gradient(to right, #28a745 0%, #ffc107 33%, #fd7e14 66%, #dc3545 100%); border-radius: 10px;"></div>\n            <div class="d-flex justify-content-between small fw-semibold mt-2">\n                <div class="text-success">0</div>\n                <div class="text-warning">'.concat(n.siaga3," ").concat(n.display,'</div>\n                <div class="text-orange" style="color: #fd7e14;">').concat(n.siaga2," ").concat(n.display,'</div>\n                <div class="text-danger">').concat(n.siaga1," ").concat(n.display,'</div>\n            </div>\n            <ul class="list-inline text-center mt-3 mb-0 small text-muted">\n                <li class="list-inline-item">Normal: <span class="text-success fw-bold">Hijau</span></li>\n                <li class="list-inline-item">Waspada: <span class="text-warning fw-bold">Kuning</span></li>\n                <li class="list-inline-item">Siaga: <span style="color: #fd7e14;" class="fw-bold">Oranye</span></li>\n                <li class="list-inline-item">Awas: <span class="text-danger fw-bold">Merah</span></li>\n            </ul>'),document.getElementById("info-panel").innerHTML=a,document.getElementById("siaga").innerHTML=r,e.n=5;break;case 4:e.p=4,o=e.v,console.error("Error:",o),document.getElementById("info-panel").innerHTML='<p class="text-danger">Gagal memuat data.</p>';case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function loadChartTMA(){return _loadChartTMA.apply(this,arguments)}function _loadChartTMA(){return(_loadChartTMA=_asyncToGenerator(_regenerator().m(function e(){var t,n,a,r,o,i,l,s,c;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,fetch("/Home/GetLastGrafik");case 1:return t=e.v,e.n=2,t.json();case 2:if(n=e.v,a=new Date,r=new Date(a.getFullYear(),a.getMonth(),a.getDate()),0!==(o=n.filter(function(e){var t=new Date(e.reading_at);return t>=r&&t<=a}).sort(function(e,t){return new Date(e.reading_at)-new Date(t.reading_at)})).length){e.n=3;break}return console.warn("Tidak ada data hari ini."),e.a(2);case 3:i=o.map(function(e){return new Date(e.reading_at).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}),l=o.map(function(e){return parseFloat(e.water_level)}),s=null!=o[0].siaga1?parseFloat(o[0].siaga1):135,Highcharts.chart("chartTMA",{chart:{type:"line"},title:{text:""},xAxis:{categories:i,title:{text:"Jam"}},yAxis:{title:{text:"TMA (m)"},min:Math.min.apply(Math,_toConsumableArray(l).concat([s]))-.2,max:Math.max.apply(Math,_toConsumableArray(l).concat([s]))+.2,plotLines:[{value:s,color:"orange",dashStyle:"ShortDash",width:2,label:{text:"Batas Siaga",align:"right",style:{color:"orange",fontWeight:"bold"}}}]},series:[{name:"TMA",data:l,color:"#007bff"}],credits:{enabled:!1}}),e.n=5;break;case 4:e.p=4,c=e.v,console.error("Gagal memuat grafik TMA:",c);case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function loadAwlrLastReading(){getData("/Home/GetLastReadingMap").then(function(e){var t,n=e;n&&200===(null===(t=n.data.metaData)||void 0===t?void 0:t.code)&&($.each(n.data.response,function(e,t){if(t.latitude&&t.longitude){var n,a=new google.maps.Marker({position:{lat:parseFloat(t.latitude),lng:parseFloat(t.longitude)},map:map,title:t.name,icon:{url:"img/duga.png",scaledSize:new google.maps.Size(40,50),anchor:new google.maps.Point(16,32)}}),r='\n                        <div class="progress-meter mt-2 mb-2">\n                            <div class="meter meter-normal meter-left" style="width: 25%;" title="Normal <br> < 6 m">\n                                <span class="fw-normal meter-text" style="color: #4DC27E;">0</span>\n                            </div>\n                            <div class="meter meter-waspada meter-left" style="width: 25%;" title="Siaga 3 <br> '.concat(t.siaga3||0," cm - ").concat(t.siaga2||0,' cm">\n                                <span class="fw-normal meter-text" style="color: #FFDA4F;">').concat(t.siaga3||0,' cm</span>\n                            </div>\n                            <div class="meter meter-siaga meter-left" style="width: 25%;" title="Siaga 2 <br> ').concat(t.siaga2||0," cm - ").concat(t.siaga1||0,' cm">\n                                <span class="fw-normal meter-text" style="color: #FFA600;">').concat(t.siaga2||0,' cm</span>\n                            </div>\n                            <div class="meter meter-awas meter-left" style="width: 25%;" title="Siaga 1 <br> > ').concat(t.siaga1||0,' cm">\n                                <span class="fw-normal meter-text" style="color: #EF5350;">').concat(t.siaga1||0," cm</span>\n                            </div>\n                        </div>\n                    ");"Normal"==t.status?n="bg-success":"Siaga 3"==t.status?n="bg-warning":"Siaga 2"==t.status?n="bg-orange":"Siaga 1"==t.status&&(n="bg-danger");var o='\n                        <div style="font-family: \'Arial\', sans-serif;\n                                    max-width: 350px;\n                                    font-size: 13px;\n                                    text-align: left;\n                                    padding: 0;\n                                    margin: 0;\n                                    line-height: 1.4;">\n\n                            \x3c!-- Judul --\x3e\n                            <div style="font-size: 16px;\n                                        font-weight: bold;\n                                        text-align: left;\n                                        margin: 0 0 6px 0;">\n                                '.concat(t.name||"Tanpa Nama",'\n                            </div>\n\n                            \x3c!-- Tabel Info --\x3e\n                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 8px;">\n                                <tr>\n                                    <td style="color: #555;">Device</td>\n                                    <td style="text-align: right;">\n                                        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 6px;">\n                                            <span>').concat(t.brand_name||"-",'</span>\n                                            <span style="\n                                                display: inline-block;\n                                                background-color: #ffc107;\n                                                color: #000;\n                                                font-size: 11px;\n                                                padding: 2px 6px;\n                                                border-radius: 6px;\n                                            ">\n                                                ').concat(t.device_id||"-",'\n                                            </span>\n                                        </div>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">Koordinat</td>\n                                    <td style="text-align: right; padding-left: 8px;">\n                                        ').concat(parseFloat(t.latitude).toFixed(6),", ").concat(parseFloat(t.longitude).toFixed(6),'\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">Status</td>\n                                    <td style="text-align: right;">\n                                        <span style="\n                                            display: inline-block;\n                                            padding: 2px 6px;\n                                            font-size: 12px;\n                                            border-radius: 6px;\n                                            color: white;"\n                                            class="').concat(n,'">\n                                            ').concat(t.status,'\n                                        </span>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td style="color: #555;">TMA</td>\n                                    <td style="text-align: right; font-weight: bold; font-size: 14px;">\n                                        ').concat(parseFloat(t.water_level||0).toFixed(1)," cm\n                                    </td>\n                                </tr>\n                            </table>\n\n                            \x3c!-- Progress Meter --\x3e\n                            ").concat(r,'<br>\n\n                            \x3c!-- Waktu --\x3e\n                            <div style="display: flex; align-items: center; font-size: 12px; color: #555; margin-top: 4px;">\n                                <i class="far fa-clock" style="margin-right: 6px;"></i>\n                                ').concat(moment(t.reading_at).locale("id").format("YYYY-MM-DD HH:mm"),'\n                            </div>\n\n                            <div style="text-align: center; margin-top: 10px;">\n                                <a href="/Home/StationDetail" class="btn btn-info btn-sm" style="display: block; width: 100%; border-radius: 25px;">Lihat Detail</a>\n                            </div>\n                        </div>\n                    '),i=new google.maps.InfoWindow({content:o});a.addListener("click",function(){i.open(map,a)})}}),setTimeout(adjustPadding,100))}).catch(function(e){console.log(e)})}function getStatusBadgeClass(e){switch((e||"").toLowerCase()){case"normal":return"bg-success text-dark";case"siaga 1":return"bg-danger text-dark";case"siaga 2":return"bg-orange";case"siaga 3":return"bg-warning";default:return"bg-secondary"}}function formatDate(e){if(!e)return"-";var t=new Date(e),n=t.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",timeZone:"Asia/Jakarta"}),a=t.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Jakarta"}).replace(".",":");return"".concat(n," ").concat(a," WIB")}function getData(e){return fetch(e).then(function(e){if(!e.ok)throw new Error("Network response was not ok");return e.json()})}function adjustPadding(){var e=document.querySelectorAll(".footer"),t=document.querySelectorAll(".tab-pane");e.forEach(function(e,n){var a=t[n];if(e&&a){var r=e.offsetHeight;a.style.paddingBottom="".concat(r,"px")}})}$(document).ready(function(){loadAwlrPanel(),loadChartTMA(),loadAwlrLastReading()});